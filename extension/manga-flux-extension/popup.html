<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manga-Flux</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="popup.css" />
</head>
<body>
  <div class="app">

    <!-- Header -->
    <header class="header">
      <div class="logo">
        <span class="logo-mark">⬡</span>
        <span class="logo-text">Manga<strong>Flux</strong></span>
      </div>
      <div class="header-right">
        <button id="healthBtn" class="icon-btn" title="Verificar API">
          <span class="icon">◉</span>
        </button>
        <button id="settingsToggle" class="icon-btn" title="Configurações">
          <span class="icon">⚙</span>
        </button>
      </div>
    </header>

    <!-- Status bar -->
    <div id="status" class="status-bar"></div>

    <!-- Tab nav -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="chapter">Capítulo</button>
      <button class="tab-btn" data-tab="pass2">Pass2</button>
      <button class="tab-btn" data-tab="log">Log</button>
    </nav>

    <!-- ═══════════════════════════════════════════════
         TAB: CHAPTER
    ═══════════════════════════════════════════════ -->
    <div class="tab-panel active" id="tab-chapter">

      <!-- Manga / Chapter IDs -->
      <div class="field-row">
        <div class="field">
          <label>Manga ID</label>
          <input id="mangaId" type="text" placeholder="ex: one_piece" />
        </div>
        <div class="field">
          <label>Capítulo</label>
          <input id="chapterId" type="text" placeholder="ex: ch_001" />
        </div>
      </div>

      <!-- Engine / Strength -->
      <div class="field-row">
        <div class="field">
          <label>Engine</label>
          <select id="engine">
            <option value="flux">Flux</option>
            <option value="dummy">Dummy</option>
          </select>
        </div>
        <div class="field">
          <label>Strength <span id="strengthDisplay" class="value-badge">1.0</span></label>
          <input id="strength" type="range" min="0" max="1" step="0.05" value="1.0" />
        </div>
      </div>

      <!-- Style reference -->
      <div class="field">
        <label>Referência de Estilo</label>
        <div class="input-group">
          <input id="styleReferenceUrl" type="url" placeholder="https://... ou use upload" />
          <label class="file-btn" title="Upload local">
            ↑
            <input id="styleReferenceFile" type="file" accept="image/*" hidden />
          </label>
        </div>
        <span id="styleReferenceHint" class="hint">Upload tem prioridade sobre URL.</span>
      </div>

      <!-- Image grid -->
      <div class="images-header">
        <span id="imagesCount" class="images-count">0 imagens</span>
        <div class="images-actions">
          <button id="captureImagesBtn" class="pill-btn primary">⊕ Capturar</button>
          <button id="clearImagesBtn" class="pill-btn ghost">✕ Limpar</button>
        </div>
      </div>
      <span id="pageImagesHint" class="hint"></span>

      <div id="thumbGrid" class="thumb-grid"></div>

      <!-- Output root -->
      <div class="field" style="margin-top:12px">
        <label>Output Root</label>
        <input id="outputRoot" type="text" placeholder="output" />
      </div>

      <!-- Run -->
      <button id="runChapterBtn" class="run-btn">
        <span class="run-icon">▶</span>
        Colorizar Capítulo
      </button>
    </div>

    <!-- ═══════════════════════════════════════════════
         TAB: PASS2
    ═══════════════════════════════════════════════ -->
    <div class="tab-panel" id="tab-pass2">

      <div class="section-title">Pass2 — Single Page</div>
      <div class="field">
        <label>Meta Path</label>
        <input id="metaPath" type="text" placeholder="metadata/page_001.meta.json" />
      </div>
      <div class="field">
        <label>Output Dir</label>
        <input id="outputDir" type="text" placeholder="outputs/api/pass2" />
      </div>
      <button id="runBtn" class="run-btn secondary">▶ Executar Pass2</button>

      <div class="divider"></div>

      <div class="section-title">Pass2 — Batch</div>
      <div class="field">
        <label>Metadata Dir</label>
        <input id="metadataDir" type="text" placeholder="metadata" />
      </div>
      <div class="field-row">
        <div class="field">
          <label>Output Dir</label>
          <input id="batchOutputDir" type="text" placeholder="outputs/api/pass2" />
        </div>
        <div class="field" style="max-width:100px">
          <label>Páginas</label>
          <input id="expectedPages" type="number" value="0" min="0" />
        </div>
      </div>
      <button id="batchBtn" class="run-btn secondary">▶ Executar Batch</button>
    </div>

    <!-- ═══════════════════════════════════════════════
         TAB: LOG
    ═══════════════════════════════════════════════ -->
    <div class="tab-panel" id="tab-log">
      <div class="log-toolbar">
        <span class="section-title">Histórico</span>
        <button id="clearHistoryBtn" class="pill-btn ghost small">Limpar</button>
      </div>
      <ul id="historyList" class="history-list"></ul>

      <div class="section-title" style="margin-top:16px">Resposta da API</div>
      <pre id="output" class="output-pre">(aguardando…)</pre>
    </div>

    <!-- ═══════════════════════════════════════════════
         SETTINGS PANEL (overlay)
    ═══════════════════════════════════════════════ -->
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="settings-header">
        <span>Configurações</span>
        <button id="settingsClose" class="icon-btn">✕</button>
      </div>

      <div class="field">
        <label>API Base URL</label>
        <input id="apiBase" type="url" value="http://127.0.0.1:8765" />
      </div>
      <div class="field">
        <label>API Token <span class="hint inline">(opcional)</span></label>
        <input id="apiToken" type="password" placeholder="••••••••" />
      </div>
      <div class="field">
        <label>Tema</label>
        <select id="themeSelect">
          <option value="auto">Auto</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>
      </div>
      <button id="saveBtn" class="run-btn" style="margin-top:8px">Salvar</button>
    </div>

  </div>
  <script src="popup.js"></script>
</body>
</html>
